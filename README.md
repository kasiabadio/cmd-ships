## Gra w statki
### Sieci Komputerowe II (2022)

### 1.	Opis projektu.

Gracze, po podłączeniu się do serwera, są ze sobą parowani i w tym momencie rozpoczyna się rozgrywka. Możliwa jest rozgrywka wielu par graczy w tym samym czasie. Początkowo, gracze równolegle rozkładają statki na planszy poprzez wpisanie pól, które chcą zaznaczyć. Po każdym położeniu statku, wyświetla się plansza ułatwiająca wizualizację gry. Gdy każdy z nich położy po 10 statków, serwer przechodzi do właściwej rozgrywki. Wysyłana jest informacja o rozpoczęciu gry, gdzie jeden z graczy pierwszy dostaje wiadomość o wpisaniu ruchu. Kiedy wpisze on poprawne pole, istniejące na planszy, wyświetla się ona, w przeciwnym przypadku gracz musi ponowić ruch. Klienty dostają informację o ruchu przeciwnika, a także informację zwrotną o swoim ruchu. Serwer rozłącza klientów, a także informuje o wyniku rozgrywki, w momencie, gdy jeden z nich trafi wszystkie statki przeciwnika.
Projekt został zaimplementowany w języku C. Aby skompilować projekt, należy wpisać komendy „gcc -Wall -lpthread Server.c -o server” oraz „gcc -Wall -lpthread Client.c -o client” w folderze z plikami projektu. Aby uruchomić klienta, należy wpisać „./client” oraz aby uruchomić serwer, należy wpisać „./server” w terminalu. O poprawności podłączenia się klientów do serwera powiadamia informacja wyświetlana w terminalu.

### 2.  Opis komunikacji pomiędzy serwerem i klientem.
	
Każdy klient ma jednocześnie działające dwa procesy, macierzysty oraz potomny, gdzie pierwszy z nich odbiera wiadomości, a drugi z nich wysyła wiadomości. Klient ma skonfigurowane dane serwera, a dokładniej, zna jego IP i łączy się do niego za pomocą funkcji connect. Serwer akceptuje połączenia od klientów, za pomocą funkcji accept. Następnie tworzy on wątek pokoju gry, gdzie odbierane są za pomocą recv, nieblokująco, z flagą MSG_DONTWAIT, wiadomości o punktach na planszy, gdzie rozłożony ma być statek. Serwer wysyła klientowi informację o tym, czy statek został położony (wysyła pola, które wcześniej przysłał klient) oraz jego orientację na planszy. W ten sposób, po odebraniu powyższej informacji od serwera, po stronie klienta, jest odpowiednio „drukowana” plansza. Gdy gracze położą po 10 statków, serwer wysyła informację klientowi, a ten po jej odebraniu, zmienia status „game” na true. W drugiej części gry, serwer odbiera wiadomości blokująco, ponieważ ruchy muszą być przemienne. Klient  wysyła  pole, w które chce trafić i jeśli było ono poprawne, zmienia się runda, w przeciwnym przypadku, jest na nim wymuszane ponowienie ruchu, aż do skutku. Serwer powiadamia klientów o wygranej lub przegranej grze.


### 3.	Podsumowanie.

Plansza gry jest reprezentowana w postaci struktury „board”, gdzie istnieje tablica jednowymiarowa typu „square” o długości stu elementów. Struktura „square” posiada informację o nazwie pola, czy jest na nim statek (0 = NO_SHIP, 1 = SHIP, 2 = BORDER) oraz, czy pole było już kliknięte. Ponadto w strukturze „board” przechowuje się tablicę jednowymiarową statków, o typie „ship”. Każdy ze statków posiada swoją nazwę (1 = PATROL, 2 = DESTROYER, 3 = SUBMARINE, 4 = BATTLESHIP), pozycję w przestrzeni, czy jest zatopiony, oraz numery pól odpowiadające kwadratom w tablicy board_alphabet <0 – 99>. Powyższe struktury pozwalają na oznaczanie pozycji statku w czasie rozgrywki, a także jego „otoczki”, gdzie nie pozwala się na położenie innego statku. Problematyczne było zaprogramowanie oznaczania statków, na tablicy jednowymiarowej, ponieważ statki mogą być ustawione poziomo lub pionowo, a także, przy granicy planszy. Dlatego należało uwzględnić wiele wariantów ułożenia (funkcja „mark”). 
